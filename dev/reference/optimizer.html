<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Creates a custom optimizer — optimizer • torch</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Creates a custom optimizer — optimizer"><meta property="og:description" content="When implementing custom optimizers you will usually need to implement
the initialize and step methods. See the example section below
for a full example."><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-178883486-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-178883486-1');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">torch</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.6.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/installation.html">Installation</a>
    </li>
    <li class="dropdown-header">Tensors</li>
    <li>
      <a href="../articles/tensor-creation.html">Creating tensors</a>
    </li>
    <li>
      <a href="../articles/indexing.html">Indexing</a>
    </li>
    <li>
      <a href="../articles/tensor/index.html">Tensor class</a>
    </li>
    <li>
      <a href="../articles/serialization.html">Serialization</a>
    </li>
    <li class="dropdown-header">Datasets</li>
    <li>
      <a href="../articles/loading-data.html">Loading Data</a>
    </li>
    <li class="dropdown-header">Autograd</li>
    <li>
      <a href="../articles/using-autograd.html">Using autograd</a>
    </li>
    <li>
      <a href="../articles/extending-autograd.html">Extending autograd</a>
    </li>
    <li>
      <a href="../articles/python-to-r.html">Python models</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/examples/basic-autograd.html">basic-autograd</a>
    </li>
    <li>
      <a href="../articles/examples/basic-nn-module.html">basic-nn-module</a>
    </li>
    <li>
      <a href="../articles/examples/dataset.html">dataset</a>
    </li>
  </ul></li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/mlverse/torch/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Creates a custom optimizer</h1>
    <small class="dont-index">Source: <a href="https://github.com/mlverse/torch/blob/HEAD/R/optim.R" class="external-link"><code>R/optim.R</code></a></small>
    <div class="hidden name"><code>optimizer.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>When implementing custom optimizers you will usually need to implement
the <code>initialize</code> and <code>step</code> methods. See the example section below
for a full example.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">optimizer</span><span class="op">(</span>
  name <span class="op">=</span> <span class="cn">NULL</span>,
  inherit <span class="op">=</span> <span class="va">Optimizer</span>,
  <span class="va">...</span>,
  private <span class="op">=</span> <span class="cn">NULL</span>,
  active <span class="op">=</span> <span class="cn">NULL</span>,
  parent_env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>name</dt>
<dd><p>(optional) name of the optimizer</p></dd>
<dt>inherit</dt>
<dd><p>(optional) you can inherit from other optimizers to re-use
some methods.</p></dd>
<dt>...</dt>
<dd><p>Pass any number of fields or methods. You should at least define
the <code>initialize</code> and <code>step</code> methods. See the examples section.</p></dd>
<dt>private</dt>
<dd><p>(optional) a list of private methods for the optimizer.</p></dd>
<dt>active</dt>
<dd><p>(optional) a list of active methods for the optimizer.</p></dd>
<dt>parent_env</dt>
<dd><p>used to capture the right environment to define the class.
The default is fine for most situations.</p></dd>
</dl></div>
    <div id="warning">
    <h2>Warning</h2>
    <p>If you need to move a model to GPU via <code>$cuda()</code>, please do so before
constructing optimizers for it. Parameters of a model after <code>$cuda()</code>
will be different objects from those before the call. In general, you
should make sure that the objects pointed to by model parameters subject
to optimization remain the same over the whole lifecycle of optimizer
creation and usage.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="torch_is_installed.html">torch_is_installed</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># In this example we will create a custom optimizer</span></span>
<span class="r-in"><span class="co"># that's just a simplified version of the `optim_sgd` function.</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">optim_sgd2</span> <span class="op">&lt;-</span> <span class="fu">optimizer</span><span class="op">(</span></span>
<span class="r-in">  initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span>, <span class="va">learning_rate</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">    <span class="va">defaults</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span class="r-in">      learning_rate <span class="op">=</span> <span class="va">learning_rate</span></span>
<span class="r-in">    <span class="op">)</span></span>
<span class="r-in">    <span class="va">super</span><span class="op">$</span><span class="fu">initialize</span><span class="op">(</span><span class="va">params</span>, <span class="va">defaults</span><span class="op">)</span></span>
<span class="r-in">  <span class="op">}</span>,</span>
<span class="r-in">  step <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">    <span class="fu"><a href="with_no_grad.html">with_no_grad</a></span><span class="op">(</span><span class="op">{</span></span>
<span class="r-in">      <span class="kw">for</span> <span class="op">(</span><span class="va">g</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">param_groups</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">        <span class="va">group</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">param_groups</span><span class="op">[[</span><span class="va">g</span><span class="op">]</span><span class="op">]</span></span>
<span class="r-in">        <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">group</span><span class="op">$</span><span class="va">params</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">          <span class="va">param</span> <span class="op">&lt;-</span> <span class="va">group</span><span class="op">$</span><span class="va">params</span><span class="op">[[</span><span class="va">p</span><span class="op">]</span><span class="op">]</span></span>
<span class="r-in"></span>
<span class="r-in">          <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">param</span><span class="op">$</span><span class="va">grad</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="is_undefined_tensor.html">is_undefined_tensor</a></span><span class="op">(</span><span class="va">param</span><span class="op">$</span><span class="va">grad</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">            <span class="kw">next</span></span>
<span class="r-in">          <span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in">          <span class="va">param</span><span class="op">$</span><span class="fu">add_</span><span class="op">(</span><span class="va">param</span><span class="op">$</span><span class="va">grad</span>, alpha <span class="op">=</span> <span class="op">-</span><span class="va">group</span><span class="op">$</span><span class="va">learning_rate</span><span class="op">)</span></span>
<span class="r-in">        <span class="op">}</span></span>
<span class="r-in">      <span class="op">}</span></span>
<span class="r-in">    <span class="op">}</span><span class="op">)</span></span>
<span class="r-in">  <span class="op">}</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="torch_randn.html">torch_randn</a></span><span class="op">(</span><span class="fl">1</span>, requires_grad <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="va">opt</span> <span class="op">&lt;-</span> <span class="fu">optim_sgd2</span><span class="op">(</span><span class="va">x</span>, learning_rate <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span class="r-in"><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="va">opt</span><span class="op">$</span><span class="fu">zero_grad</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span></span>
<span class="r-in">  <span class="va">y</span><span class="op">$</span><span class="fu">backward</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">opt</span><span class="op">$</span><span class="fu">step</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="fu">item</span><span class="op">(</span><span class="op">)</span>, <span class="fl">0</span>, tolerance <span class="op">=</span> <span class="fl">1e-9</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Daniel Falbel, Javier Luraschi.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

